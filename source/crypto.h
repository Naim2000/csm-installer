#include <stdint.h>
#include <ogc/es.h>
#include <assert.h>
#include <mbedtls/aes.h>
#include <mbedtls/sha1.h>

typedef union {
	int16_t index;
	int64_t titleid;

	int64_t part[2];

	aeskey full;
} aesiv;

static const aeskey CommonKeys[3] = {
	/* Standard common key */	{ 0xeb, 0xe4, 0x2a, 0x22, 0x5e, 0x85, 0x93, 0xe4, 0x48, 0xd9, 0xc5, 0x45, 0x73, 0x81, 0xaa, 0xf7 },
	/*  Korean common key  */	{ 0x63, 0xb8, 0x2b, 0xb4, 0xf4, 0x61, 0x4e, 0x2e, 0x13, 0xf2, 0xfe, 0xfb, 0xba, 0x4c, 0x9b, 0x7e },
	/*   vWii common key   */	{ 0x30, 0xbf, 0xc7, 0x6e, 0x7c, 0x19, 0xaf, 0xbb, 0x23, 0x16, 0x33, 0x30, 0xce, 0xd7, 0xc2, 0x8d },
};

void GetTitleKey(tik*, aeskey);
void ChangeCommonKey(tik*, uint8_t);
int DecryptTitleContent(tik* p_tik, uint16_t index, void* content, size_t csize, void* out, void* iv);
bool CheckHash(void*, size_t, sha1);